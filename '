<VirtualHost *:80>
    ServerName szakdolgozat.mollevi.eu

    # Irjuk at a HTTP kereseket HTTPS-re
    RewriteEngine On
    RewriteCond %{HTTPS} !=on
    RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R=301,L]
RewriteCond %{SERVER_NAME} =szakdolgozat.mollevi.eu
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
    ServerName szakdolgozat.mollevi.eu

    DocumentRoot /var/www/php/szakdolgozat/public

    Protocols h2 http/1.1

    SSLEngine on
    SSLOptions +StrictRequire
    SSLProtocol all -SSLv2 -SSLv3
    SSLCipherSuite HIGH:!aNULL:!MD5:!3DES

    <Directory /var/www/php/szakdolgozat/public>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

                DirectoryIndex index.php
    
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    <IfModule mod_security2.c>
        SecRuleEngine On
        SecRequestBodyAccess On
        SecResponseBodyAccess Off
        SecRule REQUEST_HEADERS:Content-Length "@rx \d+" "phase:1,deny,log,status:403,msg:'Content-Length header detected'"
        SecRule REQUEST_HEADERS:Transfer-Encoding "@rx chunked" "phase:1,deny,log,status:403,msg:'Transfer-Encoding header detected'"
    </IfModule>

        ErrorLog ${APACHE_LOG_DIR}/szakdolgozat_error.log
CustomLog ${APACHE_LOG_DIR}/szakdolgozat_access.log combined

    <FilesMatch \.php$>
        SetHandler "proxy:fcgi://127.0.0.1:9083"
    </FilesMatch>
    SSLCertificateFile /etc/letsencrypt/live/szakdolgozat.mollevi.eu/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/szakdolgozat.mollevi.eu/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
